doctype html

- let admin = (username === players[0].username);

html
  head
    title Dixit Online - Game Setup
    link(href='/css/main.css', rel='stylesheet')
  body
    h1 #{gamename}
    h2 Game Setup
    a(href="/logout") Logout
    form(action="/next/"+gameid, method="POST")
      table
        - let index = 0
        th(colspan=3) Players in game:
        each player in players
          tr
            td #{++index}
            if admin
              if index !== 1
                td
                  input(
                    type="checkbox",
                    name="players[]",
                    value=player.username
                    checked
                  )
              else
                td
            td #{player.name} #{index===1 ? '(Admin)' : ''}
      if (new Date()) < enddate
        if !admin
          if players.map(p => p.username).includes(username)
            button(
              formaction="/leave/"+gameid,
              type='submit',
              formmethod="POST",
            ) Leave Game
          else
            - let can_join = players.length<maxplayers || maxplayers===0;
            button(
              formaction="/join/"+gameid,
              type='submit',
              formmethod="POST",
              disabled=!can_join,
              title=(can_join ? false : 'Player limit reached'),
            ) Join Game
        div
          | Registration Closes
          |
          b #{enddate.toISOString().replace(/[A-Z]/g, ' ')}
      else if admin
        div
          | Joining Deadline Reached, new users can't join game
          button(
            formaction="/join/"+gameid,
            type='submit',
            formmethod="POST",
            title="Deadline Reached, click to extend",
          ) Extend Deadline
      else
        div
          | Registration Closed (
          b #{enddate.toISOString().replace(/[A-Z]/g, ' ')}
          | )
      div
        | Max players
        |
        b #{maxplayers === 0 ? "None" : maxplayers}
      if admin
        - let can_start = players.length >= 3;
        button(
          type='submit',
          disabled=!can_start,
          title=(can_start ? false : 'Not enough people'),
        ) End Setup
