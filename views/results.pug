extends layout

prepend title
  - let section = t('stages.end');
  style.
    body {
      padding-right: 0 !important;
    }

block content-outer
  each hand in hands
    div(
      class="modal fade",
      id="hand_"+hand.uname,
      tabindex="-1",
      role="dialog",
      aria-labelledby="modalLabelLarge",
      aria-hidden="true",
    )
      div(class="modal-dialog modal-lg")
        div.modal-content
          div.modal-header
            h4.modal-title #{t('hand_ownership', hand.cname)}
            button.close(
              type="button",
              data-dismiss="modal",
              aria-label="Close"
            )
              span(aria-hidden="true") &times;
          div.modal-body
            - let center = no_input = true;
            - let cards  = hand.cards;
            include cards

  div(class="table-responsive col-sm-4 col-md-4 col-lg-3 col-xl-2")
    table(class="table table-striped table-bordered table-sm")
      thead
        tr
          th(colspan=3) #{t('total_scores')}
        tr
          th(style="min-width:10px") #{t('header_number')}
          th(style="min-width:120px") #{t('player')}
          th(style="min-width:30px") #{t('score')}
      - let i = 0
      for score in scores.sort((a,b) => b.score - a.score)
        tr
          td #{++i}
          td
            a(href="/profile/"+score.uname)
              | #{score.cname}
              |
              | #{score.uname===uname ? t('you_tag') : ''}
          td
            span #{score.score}
  
  div.table-responsive
    table(class="table table-striped table-bordered table-sm")
      thead
        tr
          th(style="min-width:50px") #{t('round')}
          th(style="min-width:140px") #{t('dealer_name')}
          th(style="min-width:140px") #{t('dealer_caption')}
          th(colspan=2) #{t('dealer_card')}
          th(colspan=3*captions[0].cards.length) #{t('other_cards')}
        tr
          th(colspan=3)
          th(style="min-width:120px") #{t('votes_score')}
          th(style="min-width:150px") #{t('player_card')}
          for card in captions[0].cards
            th(style="min-width:120px") #{t('votes_score')}
            th(style="min-width:150px") #{t('player_card')}
            th(style="min-width:140px") #{t('player_name')}
      - let index = 0
      each caption in captions
        tr(class="wrap")
          td #{++index}
          td
            a(href="/profile/"+caption.uname)
              | #{caption.cname}
              |
              | #{caption.uname===uname ? t('you_tag') : ''}
          td
            span #{caption.quote}
            hr
            p #{caption.explain || t('no_explain')}
          td(align="right")
            span #{caption.votes[caption.image] || 0}
            hr
            span #{caption.scores[caption.uname] || 0}
          td
            img(
              class="rounded gamecard clickable-card",
              src=caption.image,
              data-toggle="modal",
              data-target="#hand_"+caption.uname,
              title=t('hand_ownership', caption.cname),
            )
          for card in caption.cards
            td(align="right")
              span #{caption.votes[card.card] || 0}
              hr
              span #{caption.scores[card.uname] || 0}
            td
              img(
                class="rounded gamecard clickable-card",
                src=card.card,
                data-toggle="modal",
                data-target="#hand_"+card.uname,
                title=t('hand_ownership', card.cname),
              )
              td
                a(href="/profile/"+card.uname)
                  | #{card.cname}
                  |
                  | #{card.uname===uname ? t('you_tag') : ''}
                hr
                div #{t('voted_for', card.vote||t('no_one'))}
                  
